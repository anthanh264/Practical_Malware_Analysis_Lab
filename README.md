# Practical_Malware_Analysis_Lab
This repository is my learning record to analyze malware with Practical Malware Analysis.
## Các phương pháp phân tích mã độc
- Phân tích tĩnh và phân tích động
- Phân tích cơ bản và phân tích nâng cao
#### Phân tích tĩnh cơ bản
- Theo dõi mã độc mà không cần đi sâu vào việc phân tích mã Assembly
- Công cụ: VirusTotal, Strings...
- Với cách này thì chỉ phân tích được những mẫu mã độc đơn giản, với những mẫu phức tạp thì có thể sẽ không phát hiện được những hành vi của chúng
#### Phân tích động cơ bản
- Thực thi mã độc và theo dõi hoạt động
- Dễ dàng thực hiện nhưng đòi hỏi phải có môi trường phân tích an toàn
- Không cho kết quả tốt với tất cả các loại mã độc
#### Phân tích nâng cao
* Phân tích tĩnh nâng cao:
    - Dịch ngược mã độc với các trình Disassembler
    - Độ phức tạp cao, yêu cầu kiến thức về hợp ngữ - assembly
* Phân tích động nâng cao:
    - Chạy chương trình với các trình Debugger
    - Kiểm tra trạng thái bên trong của một chương trình mã độc đang chạy. 
### Quy trình phân tích một phần mềm mã độc
- Cài đặt và cấu hình môi trường an toàn cho việc phân tích mã độc,
- Phân tích tĩnh cơ bản
- Phân tích động cơ bản
- Phân tích chuyên sâu (phân tích tĩnh nâng cao và phân tích động nâng cao)

## Công cụ và kiến thức cơ sở
###  Định dạng file thực thi trên Windows
#### PE File Format
- Là một định dạng file riêng của Win32. Hầu hết các file thực thi, Object file hay các file DLLs đều thuộc định dạng này.
- PE file là một cấu trúc dữ liệu mà Windows định nghĩa, chứa thông tin cần thiết cho windows nạp và thực thi tệp.
- Một PE file về cơ bản sẽ có các trường: DOS MZ Header, DOS Stub, PE Header, Section tables...
![](https://hackmd.io/_uploads/SyNe0rByp.png)
##### PE Header 
- PE Header thực chất là một cấu trúc (Struct) IMAGE_NT_HEADERS bao gồm các thông tin cần cho quá trình nạp file lên bộ nhớ.
    - Chứa thông tin về file
    - Loại ứng dụng
    - Các hàm và thư viện bắt buộc
    - Không gian lưu trữ được yêu cầu.
##### Một số Section quan trọng cần chú ý:
- `.text` – Vùng lưu giữ các tập chỉ thị của CPU (Mã nguồn đã được biên dịch)
- `.rdata` – Các thư viện Import và Export ra các hàm xử lý
- `.data` – Vùng chứa các biến toàn cục, static, hằng (Thực ra là chỉ lưu giữ địa chỉ của chúng còn giá trị thì lưu ở .rsrc)
- `.rsrc` – Lưu trữ các chuỗi, icon, images, menus... trong chương trình.
